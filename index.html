<!DOCTYPE html>
<html lang="bs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vaktija USK</title>

<script src="praytimes.js"></script>

<style>
body{
    font-family: Arial;
    text-align:center;
    background:#0f172a;
    color:white;
    margin:0;
    padding:20px;
}
select{
    padding:10px;
    font-size:16px;
    margin-bottom:20px;
}
.namaz{
    font-size:22px;
    margin:10px;
}
.admin{
    margin-top:20px;
    background:#16a34a;
    padding:10px;
    border-radius:10px;
}
input{
    width:60px;
}
</style>
</head>

<body>

<h2>Vaktija USK (Hanefijski)</h2>

<select id="grad">
<option value="krupa">Bosanska Krupa</option>
<option value="kladusa">Velika Kladuša</option>
</select>

<div id="vrijeme"></div>

<div class="namaz" id="fajr"></div>
<div class="namaz" id="dhuhr"></div>
<div class="namaz" id="asr"></div>
<div class="namaz" id="maghrib"></div>
<div class="namaz" id="isha"></div>

<button onclick="toggleAdmin()">Admin</button>

<div id="admin" class="admin" style="display:none;">
<h3>Ručno podešavanje (minute)</h3>
Fajr <input type="number" id="fajr_offset" value="0"><br>
Dhuhr <input type="number" id="dhuhr_offset" value="0"><br>
Asr <input type="number" id="asr_offset" value="0"><br>
Maghrib <input type="number" id="maghrib_offset" value="0"><br>
Isha <input type="number" id="isha_offset" value="0"><br><br>
<button onclick="spasiOffset()">Spasi</button>
</div>

<audio id="beep">
<source src="beep.mp3" type="audio/mpeg">
</audio>

<script>

var prayTimes = new PrayTimes('MWL');
prayTimes.adjust({asr:'Hanafi'});

var gradovi = {
    krupa: {lat:44.8825, lng:16.1514},
    kladusa: {lat:45.1842, lng:15.8058}
};

var offset = {
    fajr:0,
    dhuhr:0,
    asr:0,
    maghrib:0,
    isha:0
};

function ucitajOffset(){
    let o = localStorage.getItem("offset");
    if(o){
        offset = JSON.parse(o);
        document.getElementById("fajr_offset").value = offset.fajr;
        document.getElementById("dhuhr_offset").value = offset.dhuhr;
        document.getElementById("asr_offset").value = offset.asr;
        document.getElementById("maghrib_offset").value = offset.maghrib;
        document.getElementById("isha_offset").value = offset.isha;
    }
}

function spasiOffset(){
    offset.fajr = parseInt(document.getElementById("fajr_offset").value)||0;
    offset.dhuhr = parseInt(document.getElementById("dhuhr_offset").value)||0;
    offset.asr = parseInt(document.getElementById("asr_offset").value)||0;
    offset.maghrib = parseInt(document.getElementById("maghrib_offset").value)||0;
    offset.isha = parseInt(document.getElementById("isha_offset").value)||0;
    localStorage.setItem("offset", JSON.stringify(offset));
    update();
}

function toggleAdmin(){
    let a = document.getElementById("admin");
    a.style.display = a.style.display==="none" ? "block" : "none";
}

function dodajMinute(vrijeme, min){
    let p = vrijeme.split(":");
    let d = new Date();
    d.setHours(parseInt(p[0]));
    d.setMinutes(parseInt(p[1]) + min);
    return ("0"+d.getHours()).slice(-2)+":"+("0"+d.getMinutes()).slice(-2);
}

function update(){

    let grad = document.getElementById("grad").value;
    let koord = gradovi[grad];

    let now = new Date();
    document.getElementById("vrijeme").innerHTML =
        now.toLocaleTimeString();

    let times = prayTimes.getTimes(now, [koord.lat, koord.lng], 1);

    document.getElementById("fajr").innerHTML =
        "Fajr: " + dodajMinute(times.fajr, offset.fajr);

    document.getElementById("dhuhr").innerHTML =
        "Podne: " + dodajMinute(times.dhuhr, offset.dhuhr);

    document.getElementById("asr").innerHTML =
        "Ikindija: " + dodajMinute(times.asr, offset.asr);

    document.getElementById("maghrib").innerHTML =
        "Akšam: " + dodajMinute(times.maghrib, offset.maghrib);

    document.getElementById("isha").innerHTML =
        "Jacija: " + dodajMinute(times.isha, offset.isha);

    provjeriBeep(times);
}

function provjeriBeep(times){
    let now = new Date();
    let trenutno = ("0"+now.getHours()).slice(-2)+":"+
                   ("0"+now.getMinutes()).slice(-2);

    let lista = [
        dodajMinute(times.fajr, offset.fajr),
        dodajMinute(times.dhuhr, offset.dhuhr),
        dodajMinute(times.asr, offset.asr),
        dodajMinute(times.maghrib, offset.maghrib),
        dodajMinute(times.isha, offset.isha)
    ];

    if(lista.includes(trenutno)){
        document.getElementById("beep").play();
    }
}

document.getElementById("grad").addEventListener("change", update);

ucitajOffset();
update();
setInterval(update, 1000);

</script>

</body>
</html>
