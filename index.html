<!DOCTYPE html>
<html lang="bs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vaktija USK</title>
<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);color:white;text-align:center;}
h1{margin-top:15px;}
#date{margin:5px 0;font-size:18px;}
#clock{font-size:56px;font-weight:900;margin:5px 0;}
#nextPrayer{font-size:20px;font-weight:bold;margin-bottom:10px;}
button{padding:10px 20px;border:none;border-radius:20px;background:#00c6ff;color:black;font-weight:bold;cursor:pointer;margin-bottom:10px;}
select{padding:10px;border-radius:12px;margin-bottom:15px;font-size:16px;font-weight:bold;}
.namaz-container{display:grid;grid-template-columns: repeat(2,1fr);gap:15px;padding:15px;}
.namaz{background: rgba(255,255,255,0.1);border-radius:15px;padding:15px;backdrop-filter: blur(5px);}
.namaz h3{margin:0;font-size:20px;}
.namaz p{margin-top:8px;font-size:24px;font-weight:bold;}
.highlight{background:#00c6ff;color:black;}
footer{margin-top:20px;font-size:16px;font-weight:bold;color:#fff;}
</style>
</head>
<body>
<h1>üïå Vaktija USK</h1>
<div id="date"></div>
<div id="clock"></div>
<div id="nextPrayer"></div>
<button onclick="enableNotifications()">üîî Ukljuƒçi notifikacije</button><br>
<select id="citySelect" onchange="selectCity()">
<option value="Bihaƒá">Bihaƒá</option>
<option value="Bosanska Krupa">Bosanska Krupa</option>
<option value="Bosanski Petrovac">Bosanski Petrovac</option>
<option value="Bu≈æim">Bu≈æim</option>
<option value="Cazin">Cazin</option>
<option value="Kljuƒç">Kljuƒç</option>
<option value="Sanski Most">Sanski Most</option>
<option value="Velika Kladu≈°a">Velika Kladu≈°a</option>
</select>
<div class="namaz-container" id="namazi"></div>
<footer>by: AmelR.</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/praytimes/2.3.0/praytimes.min.js"></script>
<script>
const prayerNames={"Fajr":"Sabah","Dhuhr":"Podne","Asr":"Ikindija","Maghrib":"Ak≈°am","Isha":"Jacija"};
const prayerOrder=["Fajr","Dhuhr","Asr","Maghrib","Isha"];
let prayerTimes={};

// Gradovi i koordinate
const cityCoords={
"Bihaƒá":[44.8167,15.8700],
"Bosanska Krupa":[44.9939,16.0067],
"Bosanski Petrovac":[44.7586,16.2183],
"Bu≈æim":[44.8914,15.8006],
"Cazin":[44.9922,15.9833],
"Kljuƒç":[44.5461,16.0978],
"Sanski Most":[44.7617,16.7108],
"Velika Kladu≈°a":[45.2036,15.8744]
};

// datum i sat
function updateDate(){document.getElementById("date").textContent=new Date().toLocaleDateString("bs-BA");}
setInterval(updateDate,1000); updateDate();
function updateClock(){document.getElementById("clock").textContent=new Date().toLocaleTimeString("bs-BA");}
setInterval(updateClock,1000); updateClock();

// Notifikacije
function enableNotifications(){Notification.requestPermission().then(p=>{if(p==="granted"){alert("Notifikacije ukljuƒçene ‚úÖ");}});}

// Schedule beep 5 min prije
function schedulePrayer(vrijeme, ime){
    if(!vrijeme) return;
    const parts=vrijeme.split(":");
    const now=new Date();
    const prayerDate=new Date();
    prayerDate.setHours(parts[0],parts[1],0);
    let timeout=prayerDate-now-(5*60*1000);
    if(timeout<0) return;
    setTimeout(()=>{
        if(Notification.permission==="granted"){new Notification("üïå Vrijeme je za "+ime);}
        const beep=new Audio("https://www.soundjay.com/button/beep-07.mp3");
        beep.play().catch(()=>{});
    },timeout);
}

// Offset -4 minute
const offsetMinutes=-4;
function applyOffset(timeStr){
    const parts=timeStr.split(":");
    let date=new Date();
    date.setHours(parts[0],parts[1],0);
    date.setMinutes(date.getMinutes()+offsetMinutes);
    return date.getHours().toString().padStart(2,"0")+":"+date.getMinutes().toString().padStart(2,"0");
}

// Prikaz sljedeƒáeg namaza
function getNextPrayer(){
    const now=new Date();
    const divs=document.querySelectorAll(".namaz");
    divs.forEach(d=>d.classList.remove("highlight"));
    let next=null;
    for(let key of prayerOrder){
        const parts=prayerTimes[key].split(":");
        const prayerDate=new Date();
        prayerDate.setHours(parts[0],parts[1],0);
        if(prayerDate>now){
            document.getElementById("nextPrayer").textContent="Sljedeƒái namaz: "+prayerNames[key]+" u "+prayerTimes[key];
            divs[prayerOrder.indexOf(key)].classList.add("highlight");
            next=key; break;
        }
    }
    if(!next) document.getElementById("nextPrayer").textContent="Sljedeƒái namaz: Sabah sutra";
}

// Prikaz namaza
function showNamazi(times){
    const container=document.getElementById("namazi");
    container.innerHTML="";
    for(let key of prayerOrder){
        const div=document.createElement("div");
        div.className="namaz";
        div.innerHTML=`<h3>${prayerNames[key]}</h3><p>${times[key]}</p>`;
        container.appendChild(div);
        schedulePrayer(times[key],prayerNames[key]);
    }
    getNextPrayer();
}

// Odabir grada
function selectCity(){
    const city=document.getElementById("citySelect").value;
    const coords=cityCoords[city];
    const prayTimes=new PrayTimes('MWL');
    prayTimes.adjust({asr:'Hanafi'});
    const now=new Date();
    const times=prayTimes.getTimes(now,[coords[0],coords[1]],+1);
    prayerTimes={
        "Fajr":applyOffset(times.fajr.slice(0,5)),
        "Dhuhr":applyOffset(times.dhuhr.slice(0,5)),
        "Asr":applyOffset(times.asr.slice(0,5)),
        "Maghrib":applyOffset(times.maghrib.slice(0,5)),
        "Isha":applyOffset(times.isha.slice(0,5))
    };
    showNamazi(prayerTimes);
}

// Uƒçitaj default grad
selectCity();

// Offline support
if("serviceWorker" in navigator){navigator.serviceWorker.register("sw.js");}
</script>
</body>
</html>
