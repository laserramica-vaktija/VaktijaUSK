<!DOCTYPE html>
<html lang="bs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vaktija USK</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
    text-align:center;
}

h1{
    margin-top:15px;
}

#clock{
    font-size:48px;
    font-weight:bold;
    margin:10px 0;
}

.namaz-container{
    display:grid;
    grid-template-columns: repeat(2,1fr);
    gap:10px;
    padding:15px;
}

.namaz{
    background:rgba(255,255,255,0.1);
    border-radius:12px;
    padding:12px;
    backdrop-filter: blur(5px);
}

.namaz h3{
    margin:0;
    font-size:20px;
}

.namaz p{
    margin:5px 0 0 0;
    font-size:22px;
    font-weight:bold;
}

#qibla{
    margin-top:15px;
}

#compass{
    width:120px;
    height:120px;
    border:4px solid white;
    border-radius:50%;
    margin:auto;
    position:relative;
}

#needle{
    width:4px;
    height:60px;
    background:red;
    position:absolute;
    top:15px;
    left:50%;
    transform-origin: bottom center;
}
button{
    margin:10px;
    padding:10px 20px;
    border:none;
    border-radius:8px;
    background:#00c6ff;
    color:black;
    font-weight:bold;
    cursor:pointer;
}
</style>
</head>
<body>

<h1>üïå Vaktija USK</h1>

<div id="clock"></div>

<button onclick="enableNotifications()">üîî Ukljuƒçi notifikacije</button>

<div class="namaz-container" id="namazi"></div>

<div id="qibla">
<h2>Kibla</h2>
<div id="compass">
<div id="needle"></div>
</div>
</div>

<script>

let prayerTimes = {};

function updateClock(){
    const now = new Date();
    document.getElementById("clock").innerHTML =
        now.toLocaleTimeString("bs-BA");
}
setInterval(updateClock,1000);
updateClock();


function enableNotifications(){
    Notification.requestPermission().then(permission=>{
        if(permission === "granted"){
            alert("Notifikacije ukljuƒçene ‚úÖ");
        }
    });
}


function schedulePrayer(vrijeme, ime){
    if(!vrijeme) return;

    const parts = vrijeme.split(":");
    const now = new Date();
    const prayerDate = new Date();
    prayerDate.setHours(parts[0], parts[1], 0);

    let timeout = prayerDate - now - (5*60*1000);

    if(timeout < 0) return;

    setTimeout(()=>{
        if(Notification.permission === "granted"){
            new Notification("üïå Vrijeme je za " + ime);
        }

        const audio = new Audio("https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg");
        audio.play().catch(()=>{});
    }, timeout);
}


function showNamazi(times){

    const container = document.getElementById("namazi");
    container.innerHTML="";

    const lista = {
        "Fajr":"Sabah",
        "Dhuhr":"Podne",
        "Asr":"Ikindija",
        "Maghrib":"Ak≈°am",
        "Isha":"Jacija"
    };

    for(let key in lista){

        const div = document.createElement("div");
        div.className="namaz";

        div.innerHTML = `
            <h3>${lista[key]}</h3>
            <p>${times[key]}</p>
        `;

        container.appendChild(div);

        schedulePrayer(times[key], lista[key]);
    }
}


function getLocation(){
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
            fetchTimes(pos.coords.latitude,pos.coords.longitude);
        });
    }
}

function fetchTimes(lat,lon){
    fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=13`)
    .then(res=>res.json())
    .then(data=>{
        prayerTimes = data.data.timings;
        showNamazi(prayerTimes);
    });
}


window.addEventListener("deviceorientation", event=>{
    const needle = document.getElementById("needle");
    if(event.alpha){
        needle.style.transform = `rotate(${event.alpha}deg)`;
    }
});


getLocation();

</script>

</body>
</html>

