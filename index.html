<!DOCTYPE html>
<html lang="bs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vaktija PRO</title>
<link rel="manifest" href="manifest.json">

<style>
body{
  margin:0;
  font-family:system-ui;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  color:white;
  text-align:center;
}
h1{padding:20px 0;margin:0;}
.card{
  background:#1e293b;
  margin:10px 20px;
  padding:15px;
  border-radius:16px;
  font-size:18px;
  box-shadow:0 4px 15px rgba(0,0,0,0.4);
}
button{
  padding:10px 20px;
  border:none;
  border-radius:12px;
  background:#22c55e;
  color:white;
  font-size:16px;
  margin:10px;
}
#compass{
  width:200px;
  height:200px;
  margin:20px auto;
  border:4px solid #22c55e;
  border-radius:50%;
  position:relative;
}
#needle{
  width:4px;
  height:90px;
  background:red;
  position:absolute;
  top:10px;
  left:50%;
  transform-origin:bottom;
}
.footer{
  margin:20px;
  font-size:14px;
  color:#94a3b8;
}
</style>
</head>
<body>

<h1>üïå Vaktija PRO</h1>

<button onclick="getLocation()">üìç Moja lokacija</button>
<button onclick="enableNotifications()">üîî Ukljuƒçi notifikacije</button>

<div id="times"></div>

<h2>üß≠ Qibla</h2>
<div id="compass">
  <div id="needle"></div>
</div>

<div class="footer">
  Instaliraj preko "Add to Home Screen"
</div>

<script>
let fajrTime = "";

function getLocation(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      loadTimes(lat,lon);
      calculateQibla(lat,lon);
    });
  } else {
    alert("GPS nije podr≈æan");
  }
}

function loadTimes(lat,lon){
  fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=13`)
  .then(res=>res.json())
  .then(data=>{
    let t=data.data.timings;
    fajrTime = t.Fajr;
    document.getElementById("times").innerHTML=`
      <div class="card">Fajr: ${t.Fajr}</div>
      <div class="card">Dhuhr: ${t.Dhuhr}</div>
      <div class="card">Asr: ${t.Asr}</div>
      <div class="card">Maghrib: ${t.Maghrib}</div>
      <div class="card">Isha: ${t.Isha}</div>
    `;
  });
}

function enableNotifications(){
  Notification.requestPermission().then(permission=>{
    if(permission==="granted"){
      scheduleFajrNotification();
    }
  });
}

function scheduleFajrNotification(){
  const now = new Date();
  if(!fajrTime) return;
  const parts = fajrTime.split(":");
  const fajrDate = new Date();
  fajrDate.setHours(parts[0],parts[1],0);

  let timeout = fajrDate - now - (10*60*1000); // 10 minuta prije
  if(timeout>0){
    setTimeout(()=>{
      new Notification("Vrijeme je za Fajr namaz üïå");
    },timeout);
  }
}

function calculateQibla(lat,lon){
  const kaabaLat=21.4225*Math.PI/180;
  const kaabaLon=39.8262*Math.PI/180;

  const phi=lat*Math.PI/180;
  const lambda=lon*Math.PI/180;

  const angle=Math.atan2(
    Math.sin(kaabaLon-lambda),
    Math.cos(phi)*Math.tan(kaabaLat)-Math.sin(phi)*Math.cos(kaabaLon-lambda)
  );

  const deg=angle*180/Math.PI;
  document.getElementById("needle").style.transform=`rotate(${deg}deg)`;
}

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>