<!DOCTYPE html>
<html lang="bs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vaktija USK</title>
<link rel="manifest" href="manifest.json">

<style>
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(135deg,#e3f2fd,#bbdefb,#90caf9);
    color:#0d47a1;
    text-align:center;
}

h1{ margin-top:15px; }

#clock{
    font-size:56px;
    font-weight:900;
}

#nextPrayer{
    font-size:20px;
    font-weight:bold;
    margin-bottom:10px;
}

.namaz-container{
    display:grid;
    grid-template-columns: repeat(2,1fr);
    gap:15px;
    padding:15px;
}

.namaz{
    background:white;
    border-radius:15px;
    padding:15px;
    box-shadow:0 4px 12px rgba(0,0,0,0.1);
}

.highlight{
    background:#0d47a1;
    color:white;
}
</style>
</head>
<body>

<h1>ðŸ•Œ Vaktija USK</h1>

<div id="clock"></div>
<div id="nextPrayer"></div>

<div class="namaz-container" id="namazi"></div>

<script>
let prayerTimes = {};
let prayerOrder = ["Fajr","Dhuhr","Asr","Maghrib","Isha"];
let prayerNames = {
    "Fajr":"Sabah",
    "Dhuhr":"Podne",
    "Asr":"Ikindija",
    "Maghrib":"AkÅ¡am",
    "Isha":"Jacija"
};

function updateClock(){
    document.getElementById("clock").innerHTML =
        new Date().toLocaleTimeString("bs-BA");
}
setInterval(updateClock,1000);
updateClock();

function getNextPrayer(){
    const now = new Date();

    for(let key of prayerOrder){
        const parts = prayerTimes[key].split(":");
        const prayerDate = new Date();
        prayerDate.setHours(parts[0], parts[1], 0);

        if(prayerDate > now){
            document.getElementById("nextPrayer").innerHTML =
                "SljedeÄ‡i namaz: " + prayerNames[key] + " u " + prayerTimes[key];
            return key;
        }
    }

    document.getElementById("nextPrayer").innerHTML =
        "SljedeÄ‡i namaz: Sabah sutra";
}

function showNamazi(times){
    const container = document.getElementById("namazi");
    container.innerHTML="";

    const next = getNextPrayer();

    for(let key of prayerOrder){
        const div = document.createElement("div");
        div.className="namaz";
        if(key === next) div.classList.add("highlight");

        div.innerHTML = `
            <h3>${prayerNames[key]}</h3>
            <p>${times[key]}</p>
        `;
        container.appendChild(div);
    }
}

function fetchTimes(lat,lon){
    fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=13`)
    .then(res=>res.json())
    .then(data=>{
        prayerTimes = data.data.timings;

        // SPREMI OFFLINE
        localStorage.setItem("prayerTimes", JSON.stringify(prayerTimes));

        showNamazi(prayerTimes);
    })
    .catch(()=>{
        // AKO NEMA INTERNETA
        const saved = localStorage.getItem("prayerTimes");
        if(saved){
            prayerTimes = JSON.parse(saved);
            showNamazi(prayerTimes);
        }
    });
}

function getLocation(){
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
            fetchTimes(pos.coords.latitude,pos.coords.longitude);
        },()=>{
            loadOffline();
        });
    } else {
        loadOffline();
    }
}

function loadOffline(){
    const saved = localStorage.getItem("prayerTimes");
    if(saved){
        prayerTimes = JSON.parse(saved);
        showNamazi(prayerTimes);
    }
}

getLocation();

// REGISTRACIJA SERVICE WORKER
if("serviceWorker" in navigator){
    navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>


