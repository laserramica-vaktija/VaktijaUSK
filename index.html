<!DOCTYPE html>
<html lang="bs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vaktija USK</title>

<style>
body{
    font-family: Arial;
    text-align:center;
    background:#0f172a;
    color:white;
    margin:0;
    padding:20px;
}
select,button,input{
    padding:8px;
    margin:5px;
}
.namaz{
    font-size:22px;
    margin:8px;
}
.admin{
    margin-top:20px;
    background:#1e293b;
    padding:15px;
    border-radius:10px;
}
</style>
</head>

<body>

<h2>Vaktija USK (Hanefijski)</h2>

<select id="grad">
<option value="krupa">Bosanska Krupa</option>
<option value="kladusa">Velika Kladuša</option>
</select>

<h3 id="sat"></h3>

<div class="namaz" id="fajr"></div>
<div class="namaz" id="dhuhr"></div>
<div class="namaz" id="asr"></div>
<div class="namaz" id="maghrib"></div>
<div class="namaz" id="isha"></div>

<button onclick="login()">Admin</button>

<div id="adminPanel" class="admin" style="display:none;">
<h3>Admin Podešavanje</h3>

Fajr <input type="number" id="fajr_offset" value="0"><br>
Dhuhr <input type="number" id="dhuhr_offset" value="0"><br>
Asr <input type="number" id="asr_offset" value="0"><br>
Maghrib <input type="number" id="maghrib_offset" value="0"><br>
Isha <input type="number" id="isha_offset" value="0"><br>

<button onclick="saveOffsets()">Spasi</button>
</div>

<audio id="beep">
<source src="beep.mp3" type="audio/mpeg">
</audio>

<script>

// ADMIN PASSWORD
var ADMIN_PASSWORD = "1234";

// KOORDINATE
var gradovi = {
    krupa: {lat:44.8825, lng:16.1514},
    kladusa: {lat:45.1842, lng:15.8058}
};

var offsets = {
    fajr:0,dhuhr:0,asr:0,maghrib:0,isha:0
};

function login(){
    var pass = prompt("Unesi admin lozinku:1234");
    if(pass === ADMIN_PASSWORD){
        document.getElementById("adminPanel").style.display="block";
        ucitajOffset();
    }else{
        alert("Pogrešna lozinka");
    }
}

function ucitajOffset(){
    let o = localStorage.getItem("offsets");
    if(o){
        offsets = JSON.parse(o);
        document.getElementById("fajr_offset").value = offsets.fajr;
        document.getElementById("dhuhr_offset").value = offsets.dhuhr;
        document.getElementById("asr_offset").value = offsets.asr;
        document.getElementById("maghrib_offset").value = offsets.maghrib;
        document.getElementById("isha_offset").value = offsets.isha;
    }
}

function saveOffsets(){
    offsets.fajr = parseInt(document.getElementById("fajr_offset").value)||0;
    offsets.dhuhr = parseInt(document.getElementById("dhuhr_offset").value)||0;
    offsets.asr = parseInt(document.getElementById("asr_offset").value)||0;
    offsets.maghrib = parseInt(document.getElementById("maghrib_offset").value)||0;
    offsets.isha = parseInt(document.getElementById("isha_offset").value)||0;
    localStorage.setItem("offsets", JSON.stringify(offsets));
    alert("Spašeno!");
    update();
}

function formatTime(d){
    return ("0"+d.getHours()).slice(-2)+":"+("0"+d.getMinutes()).slice(-2);
}

function addMinutes(date, mins){
    return new Date(date.getTime() + mins*60000);
}

function calculateTimes(){

    var grad = document.getElementById("grad").value;
    var now = new Date();

    // PRIVREMENO FIKSNO TEST VRIJEME (da sigurno vidiš namaze)
    var fajr = new Date(now.getFullYear(), now.getMonth(), now.getDate(),5,30);
    var dhuhr = new Date(now.getFullYear(), now.getMonth(), now.getDate(),12,15);
    var asr = new Date(now.getFullYear(), now.getMonth(), now.getDate(),15,45);
    var maghrib = new Date(now.getFullYear(), now.getMonth(), now.getDate(),17,40);
    var isha = new Date(now.getFullYear(), now.getMonth(), now.getDate(),19,00);

    fajr = addMinutes(fajr, offsets.fajr);
    dhuhr = addMinutes(dhuhr, offsets.dhuhr);
    asr = addMinutes(asr, offsets.asr);
    maghrib = addMinutes(maghrib, offsets.maghrib);
    isha = addMinutes(isha, offsets.isha);

    document.getElementById("fajr").innerHTML = "Fajr: " + formatTime(fajr);
    document.getElementById("dhuhr").innerHTML = "Podne: " + formatTime(dhuhr);
    document.getElementById("asr").innerHTML = "Ikindija: " + formatTime(asr);
    document.getElementById("maghrib").innerHTML = "Akšam: " + formatTime(maghrib);
    document.getElementById("isha").innerHTML = "Jacija: " + formatTime(isha);

    var trenutno = formatTime(now);
    var lista = [
        formatTime(fajr),
        formatTime(dhuhr),
        formatTime(asr),
        formatTime(maghrib),
        formatTime(isha)
    ];

    if(lista.includes(trenutno)){
        document.getElementById("beep").play();
    }
}

function update(){
    document.getElementById("sat").innerHTML =
        "Trenutno vrijeme: " + new Date().toLocaleTimeString();
    calculateTimes();
}

document.getElementById("grad").addEventListener("change", update);

update();
setInterval(update,1000);

</script>

</body>
</html>
