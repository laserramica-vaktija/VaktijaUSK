<!DOCTYPE html>
<html lang="bs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vaktija USK</title>
<link rel="manifest" href="manifest.json">
<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);color:white;text-align:center;}
h1{margin-top:15px;}
#clock{font-size:56px;font-weight:900;margin:5px 0;}
#nextPrayer{font-size:20px;font-weight:bold;margin-bottom:10px;}
button{padding:10px 20px;border:none;border-radius:20px;background:#00c6ff;color:black;font-weight:bold;cursor:pointer;margin-bottom:10px;}
select{padding:10px;border-radius:12px;margin-bottom:15px;font-size:16px;font-weight:bold;}
.namaz-container{display:grid;grid-template-columns: repeat(2,1fr);gap:15px;padding:15px;}
.namaz{background: rgba(255,255,255,0.1);border-radius:15px;padding:15px;backdrop-filter: blur(5px);}
.namaz h3{margin:0;font-size:20px;}
.namaz p{margin-top:8px;font-size:24px;font-weight:bold;}
.highlight{background:#00c6ff;color:black;}
footer{margin-top:20px;font-size:16px;font-weight:bold;color:#fff;}
</style>
</head>
<body>
<h1>üïå Vaktija USK</h1>
<div id="clock"></div>
<div id="nextPrayer"></div>
<button onclick="enableNotifications()">üîî Ukljuƒçi notifikacije</button><br>
<select id="citySelect" onchange="selectCity()">
<option value="Bihaƒá">Bihaƒá</option>
<option value="Bosanska Krupa">Bosanska Krupa</option>
<option value="Bosanski Petrovac">Bosanski Petrovac</option>
<option value="Bu≈æim">Bu≈æim</option>
<option value="Cazin">Cazin</option>
<option value="Kljuƒç">Kljuƒç</option>
<option value="Sanski Most">Sanski Most</option>
<option value="Velika Kladu≈°a">Velika Kladu≈°a</option>
</select>
<div class="namaz-container" id="namazi"></div>
<footer>by: AmelR.</footer>

<script>
// Lista namaza i Hanefijski naziv
let prayerTimes={}, prayerOrder=["Fajr","Dhuhr","Asr","Maghrib","Isha"];
let prayerNames={"Fajr":"Sabah","Dhuhr":"Podne","Asr":"Ikindija","Maghrib":"Ak≈°am","Isha":"Jacija"};

// Geografske ≈°irine i du≈æine gradova USK
const citiesUSK = {
"Bihaƒá":{"lat":44.8167,"lng":15.8700},
"Bosanska Krupa":{"lat":44.9956,"lng":16.0972},
"Bosanski Petrovac":{"lat":44.7717,"lng":16.0369},
"Bu≈æim":{"lat":44.8950,"lng":16.1167},
"Cazin":{"lat":44.9897,"lng":15.9553},
"Kljuƒç":{"lat":44.5578,"lng":16.3033},
"Sanski Most":{"lat":44.7683,"lng":16.6858},
"Velika Kladu≈°a":{"lat":45.1906,"lng":15.8272}
};

// Funkcija za raƒçunanje vremena namaza (Hanefijski Asr)
function computePrayerTimes(lat,lng){
    const now = new Date();
    const timezoneOffset = now.getTimezoneOffset()/60*-1; // CET/CEST
    // Simple approximation using fixed values per month (offline) - za demo
    // Za stvarno: mogu ubaciti astronomski izraƒçun sa JS lib
    let times = {};
    // Ovdje idu aproksimacije u min za Hanefi
    const baseTimes = {
        "Fajr": 5*60+30,
        "Dhuhr": 12*60+15,
        "Asr": 15*60+5,
        "Maghrib": 17*60+45,
        "Isha": 19*60+5
    };
    for(let key in baseTimes){
        let totalMinutes = baseTimes[key]+Math.round(lat*0.1); // mali adjustment per grad
        let h=Math.floor(totalMinutes/60);
        let m=totalMinutes%60;
        times[key] = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`;
    }
    return times;
}

// Clock
function updateClock(){document.getElementById("clock").innerHTML=new Date().toLocaleTimeString("bs-BA");}
setInterval(updateClock,1000);updateClock();

function enableNotifications(){Notification.requestPermission().then(p=>{if(p==="granted"){alert("Notifikacije ukljuƒçene ‚úÖ");}});}

function schedulePrayer(vrijeme, ime){
    if(!vrijeme) return;
    const parts=vrijeme.split(":");
    const now=new Date();
    const prayerDate=new Date();
    prayerDate.setHours(parts[0],parts[1],0);
    let timeout=prayerDate-now-(5*60*1000);
    if(timeout<0) return;
    setTimeout(()=>{
        if(Notification.permission==="granted"){new Notification("üïå Vrijeme je za "+ime);}
        const audio = new Audio("azan.mp3");
        audio.play().catch(()=>{});
    },timeout);
}

function getNextPrayer(){
    const now=new Date();
    for(let key of prayerOrder){
        const parts=prayerTimes[key].split(":");
        const prayerDate=new Date();
        prayerDate.setHours(parts[0],parts[1],0);
        if(prayerDate>now){document.getElementById("nextPrayer").innerHTML="Sljedeƒái namaz: "+prayerNames[key]+" u "+prayerTimes[key];return key;}
    }
    document.getElementById("nextPrayer").innerHTML="Sljedeƒái namaz: Sabah sutra";
}

function showNamazi(times){
    const container=document.getElementById("namazi");container.innerHTML="";
    const next=getNextPrayer();
    for(let key of prayerOrder){
        const div=document.createElement("div");
        div.className="namaz";
        if(key===next) div.classList.add("highlight");
        div.innerHTML=`<h3>${prayerNames[key]}</h3><p>${times[key]}</p>`;
        container.appendChild(div);
        schedulePrayer(times[key],prayerNames[key]);
    }
}

function selectCity(){
    const city=document.getElementById("citySelect").value;
    let c = citiesUSK[city];
    prayerTimes=computePrayerTimes(c.lat,c.lng);
    localStorage.setItem("prayerTimes-"+city,JSON.stringify(prayerTimes));
    showNamazi(prayerTimes);
}

function loadDefaultCity(){
    selectCity();
}
loadDefaultCity();

// Offline support
if("serviceWorker" in navigator){navigator.serviceWorker.register("sw.js");}
</script>
</body>
</html>
